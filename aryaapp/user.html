<!doctype html>
<html>
	<head>
       <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
		<title>Arya Fire and Safety</title>
            
     <link rel="stylesheet"  href="css/main-styles.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css" />
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
 
  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script> 
        <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script> 
        <script src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script>
        if(window.localStorage["token"]==""){ window.location.replace("index.html");}
        </script>
	</head>
	<body>
   <div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="btn btn-lg closebtn glyphicon glyphicon-menu-left" onclick="closeNav()"></a>
  <p>Welcome <span id="user">!</span></p><br/>
  <ul class="list-group">
  
  <li class="list-group-item">Log Out  <button type="button" id="logout_button"class="btn btn-danger"> <span class="glyphicon glyphicon-log-out"></span></button></li> 
</ul>
  
 

</div>
<div class="navbar navbar-default navbar-fixed-top">
    <!-- Use any element to open the sidenav -->
<span id="menu" class="btn btn-lg glyphicon glyphicon-menu-hamburger" onclick="openNav()"></span>
        </div>


<!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
<div id="main">
  		<div class="container">
            <div><h1 align="center">Arya Fire &amp; Safety</h1></div>
			
			<div class="box" id="main-body">
				
				<table id="product_data" class="table table-striped table-bordered dt-responsive nowrap" style="width:100%" >
					<thead>
						<tr>
							<th width="5%">Product Image</th>
							<th width="5%">Product</th>
                            <th width="5%">Price</th>
							<th width="5%">Supplier</th>
                            <th width="5%">Quotation Date</th>
                            <th width="5%">Tax</th>
                            <th width="5%">HSN Code</th>
                            <th width="5%">Product Code</th>
                            <th width="50%">Specification</th>
                           
						</tr>
					</thead>
				</table>
				
			</div>
            
		</div>
    </div>
        <footer class="navbar navbar-default navbar-fixed-bottom">
            <h6 class="text-center">App Developed by www.omsolutions.biz</h6>
		</footer>
	</body>
</html>



<script type="text/javascript" language="javascript" >

function init() {
    //Check Token
    $.ajax({
    url:"check_token.php",
    method:"POST",
    data:{token: window.localStorage["token"] , name: window.localStorage["name"] },
    cache:false,
    dataType:"json",
    success:function(data)
    {
         
     window.localStorage["token"]=data.token;
     window.localStorage["name"]=data.name; 
     window.localStorage["logged_in"]=data.logged_in;
     window.localStorage["user"]=data.user;
   
     }
    
   });
    ////Check Token End////////////////////////          
   
  
    
}    
    
 /* Set the width of the side navigation to 250px */
function openNav() {
  document.getElementById("mySidenav").style.width = "200px";
    
}

/* Set the width of the side navigation to 0 */
function closeNav() {
  document.getElementById("mySidenav").style.width = "0";
}
    
$(document).ready(function(){
   
setInterval(function(){
         init()
 },18000000); 
 setInterval(function(){
         checkLogin()
 },2000); 
 
    
	function checkLogin(){
	if (window.localStorage["logged_in"]!="true"){
        document.getElementById("menu").style.visibility="hidden";
        console.log("login Failed");
       document.getElementById("main-body").innerHTML='<div class="alert alert-danger">Login is Required to Use this App</div><button  id="login_button" type="button" class="btn btn-primary btn-block btn-lg">Login</button';
       // alert("Login Required");
        document.getElementById("login_button").onclick= function(){  window.location.replace("index.html");  }
    
    }else{
      console.log("login success");
        document.getElementById("user").innerHTML=window.localStorage["name"]+ '!';
    }
    }
   
      if (window.localStorage["logged_in"]=="true"){
          init()
         var dataTable = $('#product_data').DataTable({
       
		"processing":true,
		"serverSide":true,
		"order":[],
		"ajax":{
			url:"fetch.php",
			type:"POST",
            dataType:"json"
		},
		"columnDefs":[
			{
				"targets":[0, 6, 7],
				"orderable":false
			}
            
		],
       
         responsive: {
            details: {
                display: $.fn.dataTable.Responsive.display.modal( {
                    header: function ( row ) {
                        var data = row.data();
                        return 'Details for '+data[1]+' of '+data[3];
                    }
                } ),
                renderer: $.fn.dataTable.Responsive.renderer.tableAll( {
                    tableClass: 'table'
                } )
            }
        }

	});
      }
	$('#logout_button').click(function(){
        document.getElementById("mySidenav").style.width = "0";
        document.getElementById("menu").style.visibility="hidden";
    window.localStorage["logged_in"]="false";
      window.localStorage["token"]="";
        window.localStorage["name"]="";
        window.localStorage["user"]="";
        window.location.replace("index.html");
	});
 
});
</script>